#!/usr/bin/env node

// Use of this source code is governed by an Apache 2.0 license
// that can be found in the LICENSE file.

'use strict';

const path = require('path');
const {Command} = require('commander');
const {Builder} = require('../src/builder');

const rootDir = path.join(path.dirname(process.argv[1]), '..', '..');
const builder = new Builder(rootDir);

const program = new Command();
program.version(require('../package.json').version);

program
  .command('sync')
  .action(() => {
    builder.initConfig();
    builder.actionSync();
  });

program
  .command('pull')
  .action(() => {
    builder.initConfig();
    builder.actionPull();
  });

program
  .command('build')
  .option('-b, --backend <backend>', 'Build with target backend', 'null')
  .option('-c, --config <config>', 'Configuration file',
  'build_script/bot_config.json')
  .action((options) => {
    builder.initConfig(options.backend, options.config);
    builder.actionBuild();
  });

program
  .command('all')
  .option('-b, --backend <backend>', 'Build with target backend', 'null')
  .option('-c, --config <config>', 'Configuration file',
  'build_script/bot_config.json')
  .action((options) => {
    builder.initConfig(options.backend, options.config);
    builder.actionAll();
  });

program.parse();
